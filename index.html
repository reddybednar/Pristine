<!DOCTYPE html>
<head>
    <title>Pristine test</title>
    <style>
        .formRow {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
        }
        .formRowLabel + .formRowControl {
            margin-left: 15px;
        }
        .formRowErrors {
            margin-left: 15px;
        }
        .formRow.has-success input:not([type^=hidden]):not([type^=submit]):not([type^="checkbox"]) {
            border-color: greenyellow;
        }
        .pristine-error {
            color: red;
        }
    </style>
</head>
<body>
    <form id="form" action="index.html" method="GET">
        <div class="formRow">
            <div class="formRowLabel">
                <label for="fullname">Fullname:</label>
            </div>
            <div class="formRowControl">
                <input id="fullname" name="fullname" type="text" pattern="/^(\+|00)\d{5,12}$|^\d{9}$/">
            </div>
            <div class="formRowErrors"></div>
        </div>
        <div class="formRow">
            <div class="formRowLabel">
                <label for="email">E-mail:</label>
            </div>
            <div class="formRowControl">
                <input id="email" minlength="10" type="email" data-pristine-ares name="email" required>
            </div>
            <div class="formRowErrors"></div>
        </div>
        <div class="formRowControl">
            <label for="wrong">
                <input id="wrong" type="checkbox" data-pristine-exclude="true">
                Špatnej checkbox
            </label>
        </div>
        <div class="formRow">
            <div class="formRowLabel">
                <label for="hasphone">Mám telefon?</label>
            </div>
            <div class="formRowControl">
                <input id="hasphone" name="hasphone" type="checkbox"> 
            </div>
            <div class="formRowErrors"></div>
        </div>
        <div id="phone-form-group" class="formRow">
            <div class="formRowLabel">
                <label for="phone">Phone:</label>
            </div>
            <div class="formRowControl">
                <input id="phone" type="text" name="phone" required>
            </div>
            <div class="formRowErrors"></div>
        </div>
        <div class="formRow">
            <div class="formRowLabel">
                <label for="agree">Souhlas</label>
            </div>
            <div class="formRowControl">
                <input id="agree" name="agree" type="checkbox" required> 
            </div>
            <div class="formRowErrors"></div>
        </div>
        <button type="submit">Submit</button>
    </form>

    <script src="dist/pristine.js"></script>
    <script>
        window.onload = () => {
            var form = document.getElementById("form");

            Pristine.addValidator('ares', () => {
                console.log('Hello from custom validator');
            }, 'Custom validator je špatně');

            var pristine = new Pristine(form, {
                classTo: 'formRow',
                errorTextParent: 'formRowErrors',
            });

            form.addEventListener('submit', function (e) {
                e.preventDefault();
                if (pristine.validate()) {
                    e.target.submit();
                }
            });
        };

        const updatephonegroup = (checkbox) => {
            const phonegroup = document.getElementById('phone-form-group');
            if (hasphone.checked) {
                phonegroup.removeAttribute('data-pristine-exclude');
                phonegroup.setAttribute('required', '');
                phonegroup.style.display = '';
            } else {
                phonegroup.style.display = 'none';
                phonegroup.setAttribute('data-pristine-exclude', '');
                phonegroup.removeAttribute('required');
            }
        }

        const hasphone = document.getElementById('hasphone');
        hasphone.addEventListener('change', (event) => {
            updatephonegroup(event.target);
        });
        updatephonegroup(hasphone);
    </script>
</body>
</html>